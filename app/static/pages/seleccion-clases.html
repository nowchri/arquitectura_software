<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Selección de Clases - Academia Trazos & Latices</title>
    <script src="https://kit.fontawesome.com/668c4bf34c.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../stylepages.css">
    <link rel="icon" type="image/x-icon" href="../imgs/logo_main.ico">
</head>

<body>
    <div class="dashboard-wrapper">
        <!-- Este div será reemplazado por el menú -->
        <div id="sidebar-placeholder"></div>

        <!-- Contenido principal -->

        <main>
            <header>
                <h1>Selección de Clases</h1>
                <div class="profile">
                    <span class="profile__role">Gerente</span>
                    <div class="profile__avatar">
                        <!--<img src="../imgs/gerente.jpg" alt="Perfil Gerente">-->
                        <img src="../imgs/img-admin.webp" alt="Perfil Gerente">
                        <span class="profile__status" aria-hidden="true"></span>
                    </div>
                </div>
            </header>
            <!-- Contenido principal -->
            <section class="content content--listado">
                <!-- Opciones de selección de clases -->
                <div class="clases-options">
                    <a href="asignacion-clase.html" class="clase-option">
                        <div class="clase-option__icon">
                            <i class="fa-solid fa-users-between-lines fa-3x"></i>
                        </div>
                        <div class="clase-option__label">Asignación de clases</div>
                    </a>
                    <a href="#" class="clase-option" id="crear-clase-trigger">
                        <div class="clase-option__icon">
                            <i class="fa-solid fa-chalkboard-user fa-3x"></i>
                        </div>
                        <div class="clase-option__label">Crear Clase</div>
                    </a>
                    <!-- Nueva tarjeta: Crear Plan de Clase -->
                    <a href="#" class="clase-option" id="crear-plan-trigger">
                        <div class="clase-option__icon">
                            <i class="fa-solid fa-folder-plus fa-3x"></i>
                        </div>
                        <div class="clase-option__label">Crear Plan de Clase</div>
                    </a>
                </div>
            </section>
        </main>
    </div>

    <!-- ... resto del HTML igual hasta el modal de Crear Clase ... -->

    <!-- Popup (Modal) para Crear Clase -->
    <div class="modal" id="crear-clase-modal">
        <div class="modal__content">
            <h2>Crear clase</h2>
            <form class="create-class-form" id="crear-clase-form">
                <div class="detail-form__group">
                    <label for="nombre-clase">Nombre de la Clase:</label>
                    <input type="text" id="nombre-clase" name="nombre-clase"
                        placeholder="Pigmentación artística del cuerpo" required>
                </div>
                <div class="field-row">
                    <div class="field">
                        <label for="fecha-clase">Fecha:</label>
                        <input type="date" id="fecha-clase" name="fecha-clase" required>
                    </div>
                    <div class="field">
                        <label for="hora-clase">Hora:</label>
                        <select id="hora-clase" name="hora-clase" required>
                            <option value="" disabled selected>Seleccione una hora</option>
                            <!-- Horas de 8:00 a 18:30 -->
                            <option value="08:00">8:00 AM</option>
                            <option value="08:30">8:30 AM</option>
                            <option value="09:00">9:00 AM</option>
                            <option value="09:30">9:30 AM</option>
                            <option value="10:00">10:00 AM</option>
                            <option value="10:30">10:30 AM</option>
                            <option value="11:00">11:00 AM</option>
                            <option value="11:30">11:30 AM</option>
                            <option value="12:00">12:00 PM</option>
                            <option value="12:30">12:30 PM</option>
                            <option value="13:00">1:00 PM</option>
                            <option value="13:30">1:30 PM</option>
                            <option value="14:00">2:00 PM</option>
                            <option value="14:30">2:30 PM</option>
                            <option value="15:00">3:00 PM</option>
                            <option value="15:30">3:30 PM</option>
                            <option value="16:00">4:00 PM</option>
                            <option value="16:30">4:30 PM</option>
                            <option value="17:00">5:00 PM</option>
                            <option value="17:30">5:30 PM</option>
                            <option value="18:00">6:00 PM</option>
                            <option value="18:30">6:30 PM</option>
                        </select>
                    </div>
                </div>
                <div class="detail-form__actions">
                    <button type="submit" class="btn-primary" id="create-class-btn">Crear Clase</button>
                    <button type="button" class="btn-secondary" id="cancel-create-btn">Volver</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Popup (Modal) para Crear Plan de Clase -->
    <div class="modal" id="crear-plan-modal">
        <div class="modal__content">
            <h2>Plan de Clases</h2>
            <form class="create-plan-form">

                <div class="detail-form__group">
                    <label for="nombre-plan">Nombre:</label>
                    <input type="text" id="nombre-plan" name="nombre-plan" placeholder="Ingrese el nombre del plan">
                </div>
                <div class="detail-form__group">
                    <label for="descripcion-plan">Descripcion:</label>
                    <input type="text" id="descripcion-plan" name="descripcion-plan"
                        placeholder="Ingrese la descripción del plan">
                </div>
                <div class="detail-form__group">
                    <label for="numero-clases-mes">Numero de clases al mes:</label>
                    <input type="number" id="numero-clases-mes" name="numero-clases-mes"
                        placeholder="Ingrese el número de clases por mes">
                </div>
                <div class="detail-form__group">
                    <label for="precio-mensualidad">Precio mensualidad:</label>
                    <input type="number" id="precio-mensualidad" name="precio-mensualidad"
                        placeholder="Ingrese el precio mensualidad">
                </div>
                <div class="detail-form__actions">
                    <button type="button" class="btn-primary" id="create-plan-btn">Crear Plan</button>
                    <button type="button" class="btn-secondary" id="cancel-plan-btn">Volver</button>
                </div>
            </form>
        </div>
    </div>
    <script>
        // Script para manejar los popups
        const crearClaseTrigger = document.getElementById('crear-clase-trigger');
        const crearPlanTrigger = document.getElementById('crear-plan-trigger');
        const crearClaseModal = document.getElementById('crear-clase-modal');
        const crearPlanModal = document.getElementById('crear-plan-modal');
        const createClassBtn = document.getElementById('create-class-btn');
        const cancelCreateBtn = document.getElementById('cancel-create-btn');
        const createPlanBtn = document.getElementById('create-plan-btn');
        const cancelPlanBtn = document.getElementById('cancel-plan-btn');

        // Mostrar el modal de Crear Clase al hacer clic
        crearClaseTrigger.addEventListener('click', function (e) {
            e.preventDefault();
            crearClaseModal.style.display = 'flex';
        });

        // Mostrar el modal de Crear Plan de Clase al hacer clic
        crearPlanTrigger.addEventListener('click', function (e) {
            e.preventDefault();
            crearPlanModal.style.display = 'flex';
        });

        // Cerrar el modal de Crear Clase
        cancelCreateBtn.addEventListener('click', function () {
            crearClaseModal.style.display = 'none';
        });

        // Cerrar el modal de Crear Plan de Clase
        cancelPlanBtn.addEventListener('click', function () {
            crearPlanModal.style.display = 'none';
        });

        // Cerrar los modales si se hace clic fuera del contenido
        crearClaseModal.addEventListener('click', function (e) {
            if (e.target === crearClaseModal) {
                crearClaseModal.style.display = 'none';
            }
        });

        crearPlanModal.addEventListener('click', function (e) {
            if (e.target === crearPlanModal) {
                crearPlanModal.style.display = 'none';
            }
        });

        // Función para cargar el menú
        // Establecer fecha mínima (hoy)
        document.getElementById('fecha-clase').min = new Date().toISOString().split('T')[0];

        // Crear clase
        document.getElementById('crear-clase-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const nombre = document.getElementById('nombre-clase').value.trim();
            const fecha = document.getElementById('fecha-clase').value;
            const hora = document.getElementById('hora-clase').value;

            if (!nombre || !fecha || !hora) {
                alert('Por favor complete todos los campos.');
                return;
            }

            // Combinar fecha y hora en formato ISO: "2023-11-15T10:00:00"
            const fechaHora = `${fecha}T${hora}:00`;

            const claseData = {
                nombre: nombre,
                fecha_hora: fechaHora,
                contador_clase: 1,  // ← Siempre 1
                id_plan: null,      // ← Null
                id_estudiante: null // ← Null
            };

            try {
                const res = await fetch('http://127.0.0.1:8000/api/clases/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(claseData)
                });
                if (!res.ok) {
                    const errorText = await res.text();
                    try {
                        const errorJson = JSON.parse(errorText);
                        throw new Error(errorJson.detail || "Error al crear la clase");
                    } catch (e) {
                        throw new Error(`Error del servidor: ${errorText}`);
                    }
                }
                alert('¡Clase creada con éxito!');
                document.getElementById('crear-clase-modal').style.display = 'none';
                document.getElementById('crear-clase-form').reset();
            } catch (err) {
                console.error(err);
                alert(`Error: ${err.message}`);
            }
        });

    </script>
    <script src="scripts/menu-loader.js"></script>


</body>

</html>